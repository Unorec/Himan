<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HiMAN管理系統 - 主控台</title>
    <!-- 先載入 Tailwind -->
    <link href="./css/tailwind.css" rel="stylesheet">
    <!-- 再載入自訂樣式 -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/entry-form.css">
    <link rel="stylesheet" href="css/entry-records.css">
    <link rel="stylesheet" href="css/entry-records/active-lockers.css">
    <link rel="stylesheet" href="css/entry-records/history.css">
    <link rel="stylesheet" href="css/entry-records/time-tracking.css">
    <link rel="stylesheet" href="css/entry-records/temp-leave.css">
    <!-- 修正錯誤處理腳本 -->
    <script>
        window.addEventListener('error', function(e) {
            if (e.filename && e.filename.startsWith('chrome-error://')) {
                e.preventDefault();
                console.warn('Ignored chrome-error protocol message');
            }
        });
    </script>
</head>
<body class="bg-gray-50">
    <div id="mainSystem" class="flex h-screen">
        <!-- 側邊導航區 -->
        <aside class="sidebar">
            <div class="p-6">
                <h1 class="text-2xl font-bold text-gray-800">HiMAN 系統</h1>
                <p class="text-sm text-gray-500 mt-1">優雅的管理體驗</p>
            </div>
            
            <nav class="mt-6" id="mainNav">
                <button class="nav-item active" data-page="entryForm">
                    <span class="icon">📝</span>
                    <span class="nav-text">入場登記</span>
                </button>
                <button class="nav-item" data-page="recordsSection">
                    <span class="icon">📅</span>
                    <span class="nav-text">紀錄查詢</span>
                </button>
                <button class="nav-item" data-page="statsSection">
                    <span class="icon">📊</span>
                    <span class="nav-text">營業報表</span>
                </button>
                <button class="nav-item" data-page="ticketsSection">
                    <span class="icon">🎫</span>
                    <span class="nav-text">票券管理</span>
                </button>
            </nav>

            <!-- 登出按鈕 -->
            <div class="logout-section">
                <button class="nav-item logout-btn" id="logoutBtn">
                    <span class="icon">🚪</span>
                    <span class="nav-text">登出系統</span>
                </button>
            </div>
        </aside>

        <!-- 主要內容區域 -->
        <main class="flex-1 p-8">
            <!-- 通知提示的優雅展現 -->
            <div id="notification" class="notification hidden"></div>
            
            <!-- 入場登記表單 (預設顯示) -->
            <div id="entryForm" class="page-section active">
                <form id="registrationForm" class="entry-form">
                    <!-- 櫃位號碼和時間顯示區域 -->
                    <div class="entry-header">
                        <div class="locker-time-container">
                            <div class="locker-section">
                                <label for="lockerNumber" class="form-label">櫃位號碼</label>
                                <input type="number" id="lockerNumber" class="locker-input" min="1" max="500" required>
                            </div>
                            <div class="current-datetime">
                                <div class="date-display">
                                    <span id="currentDate" class="date"></span>
                                </div>
                                <div class="time-display">
                                    <span id="currentTime" class="time"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 入場時間顯示 -->
                    <div class="form-group entry-time">
                        <label for="entryTime" class="form-label">入場時間</label>
                        <input type="text" id="entryTime" class="form-input" readonly>
                        <div id="discountPeriod" class="price-info">
                            <div class="price-header">
                                <span class="time-badge"></span>
                                <span class="discount-badge"></span>
                            </div>
                            <div class="price-details">
                                <span id="currentPrice"></span>
                            </div>
                        </div>
                    </div>

                    <!-- 付款資訊區塊 -->
                    <section class="payment-section form-section">
                        <h3 class="section-title">付款資訊</h3>
                        <div class="payment-options">
                            <label class="radio-label">
                                <input type="radio" name="paymentType" value="cash" checked>
                                <span>現金付款</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="paymentType" value="ticket">
                                <span>票券使用</span>
                            </label>
                        </div>

                        <!-- 票券輸入區域 -->
                        <div id="ticketArea" class="payment-content" style="display: none;">
                            <div class="form-group">
                                <label class="form-label" for="ticketNumber">票券編號</label>
                                <input type="text" id="ticketNumber" class="form-input" placeholder="請輸入票券編號">
                            </div>   
                        </div>

                        <!-- 現金付款區域 -->
                        <div id="cashArea" class="payment-content">
                            <div class="amount-container">
                                <div class="form-group">
                                    <label class="form-label" for="amount">金額</label>
                                    <input type="number" id="amount" class="form-input" required>
                                </div>
                                <div class="custom-amount">
                                    <input type="checkbox" id="customAmount">
                                    <label for="customAmount">自行輸入金額</label>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- 備註區域移動到這裡 -->
                    <section class="form-section"></section>
                        <h3 class="section-title">備註說明</h3>
                        <div class="remarks-area">
                            <textarea id="remarks" class="form-textarea" placeholder="請輸入備註事項..."></textarea>
                        </div>
                    </section>

                    <!-- 確認按鈕區塊 -->
                    <section class="action-section">
                        <button type="submit" class="btn btn-primary">確認登記</button>
                    </section>
                </form>
            </div>

            <!-- 紀錄查詢區塊 -->
            <div id="recordsSection" class="page-section hidden">
    <div class="page-header mb-6">
        <h2 class="text-2xl font-bold text-gray-900">入場紀錄查詢</h2>
    </div>
    
    <div class="search-section">
        <div class="search-form">
            <div class="search-row">
                <div class="form-group">
                    <label for="startDate">開始日期</label>
                    <input type="date" id="startDate" class="form-input">
                </div>
                <div class="form-group">
                    <label for="endDate">結束日期</label>
                    <input type="date" id="endDate" class="form-input">
                </div>
                <div class="form-group">
                    <label for="searchLockerNumber">櫃位號碼</label>
                    <input type="number" id="searchLockerNumber" class="form-input" min="1" max="500">
                </div>
            </div>
            
            <div class="search-row">
                <div class="form-group">
                    <label for="searchPaymentType">付款方式</label>
                    <select id="searchPaymentType" class="form-input">
                        <option value="">全部</option>
                        <option value="cash">現金</option>
                        <option value="ticket">票券</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="searchPriceType">時段類型</label>
                    <select id="searchPriceType" class="form-input">
                        <option value="">全部</option>
                        <option value="regular">一般時段</option>
                        <option value="discount">優惠時段</option>
                        <option value="towel-night">小毛巾之夜</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="searchStatus">狀態</label>
                    <select id="searchStatus" class="form-input">
                        <option value="">全部</option>
                        <option value="active">使用中</option>
                        <option value="completed">已結束</option>
                    </select>
                </div>
            </div>

            <div class="search-btn-group">
                <button id="resetSearchBtn" class="btn btn-secondary">重置</button>
                <button id="searchRecordsBtn" class="btn btn-primary">搜尋</button>
            </div>
        </div>
    </div>

    <div class="results-section">
        <div class="results-header">
            <div class="results-summary">
                共找到 <span id="totalRecords" class="font-semibold text-blue-600">0</span> 筆記錄
                <span class="amount-summary">總金額：<span id="totalAmount">0</span> 元</span>
            </div>
            <div class="export-actions">
                <button class="btn btn-outline" id="exportBtn">
                    <span class="icon">📊</span>
                    匯出報表
                </button>
            </div>
        </div>
        
        <div class="table-container">
            <table class="records-table">
                <thead>
                    <tr>
                        <th>日期時間</th>
                        <th>櫃位號碼</th>
                        <th>付款方式</th>
                        <th>金額/票號</th>
                        <th>時段類型</th>
                        <th>狀態</th>
                        <th>備註</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="recordsTableBody">
                    <!-- 資料將由 JavaScript 動態插入 -->
                </tbody>
            </table>
        </div>

        <div class="pagination">
            <button id="prevPageBtn" class="btn btn-outline">上一頁</button>
            <span id="pageInfo">第 <span id="currentPage">1</span> 頁 / 共 <span id="totalPages">1</span> 頁</span>
            <button id="nextPageBtn" class="btn btn-outline">下一頁</button>
        </div>
    </div>
</div>

            <div id="statsSection" class="page-section hidden">
                <!-- 營業報表內容 -->
            </div>

            <div id="ticketsSection" class="page-section hidden">
                <!-- 票券管理內容 -->
            </div>
        </main>
    </div>

    <!-- 費用明細對話框 -->
    <div id="feeDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>費用明細</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="fee-details">
                    <!-- ...existing code... -->
                </div>
            </div>
        </div>
    </div>

    <!-- 修改腳本引用順序 -->
    <script src="js/core/system.js" type="module"></script>
    <script src="js/modules/auth.js" type="module"></script>
    <script src="js/modules/checkin.js" type="module"></script>
    <script src="js/modules/storage.js" type="module"></script>
    <script src="js/entry.js" type="module"></script>
</body>
</html>