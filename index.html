<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style"="default">
    <title>HiM AN 管理系統 - 優雅的入場體驗</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/entry.css">
    <link rel="stylesheet" href="css/records.css">
    <link rel="stylesheet" href="css/tickets.css">
    <link rel="stylesheet" href="css/stats.css">
    <link rel="stylesheet" href="css/systemSettings.css">
    
    <!-- 修改 Chart.js CDN 引入 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <!-- JavaScript 檔案 -->
    <script src="js/storage.js"></script>
    <script defer src="js/main.js"></script>
    <script defer src="js/tickets.js"></script>
    <script defer src="js/entry.js"></script>
    <script defer src="js/records.js"></script>
    <script defer src="js/stats.js"></script>
    <script defer src="js/systemSettings.js"></script>
</head>
<body>
    <header>
        <h1>HiMAN 管理系統</h1>
        <nav>
            <ul>
                <li><a href="#entry">入場登記</a></li>
                <li><a href="#records">入場記錄</a></li>
                <li><a href="#tickets">票券管理</a></li>
                <li><a href="#stats">營業報表</a></li>
                <li><a href="#systemSettings">系統設定</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <!-- 入場登記區塊 -->
        <section id="entry">
            <h2>入場登記</h2>
            <div class="entry-form-container">
                <form id="entryForm">
                    <div class="form-group">
                        <label>付款方式:</label>
                        <div class="payment-options">
                            <label>
                                <input type="radio" name="paymentType" value="cash" checked> 現金
                            </label>
                            <label>
                                <input type="radio" name="paymentType" value="ticket"> 票券
                            </label>
                        </div>
                    </div>
                    
                    <div id="cashPayment" class="form-group">
                        <label for="cashAmount">金額:</label>
                        <input type="number" id="cashAmount" name="cashAmount" min="0" step="1">
                        <span id="suggestedPrice" class="price-suggestion"></span>
                    </div>
                    
                    <div id="ticketPayment" class="form-group" style="display: none;">
                        <label for="ticketNumber">票券號碼:</label>
                        <input type="text" id="ticketNumber" name="ticketNumber" 
                               pattern="[HM][0-9]+" 
                               placeholder="H開頭(平日券)或M開頭(暢遊券)"
                               maxlength="7"
                               autocomplete="off">
                        <div class="ticket-hint">
                            <small>※ H開頭為平日券（限週一至週四使用）</small><br>
                            <small>※ M開頭為暢遊券（無使用限制）</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="lockerNumber">置物櫃號碼:</label>
                        <div class="locker-input-group">
                            <input type="number" id="lockerNumber" name="lockerNumber" 
                                   min="1" max="500" required 
                                   placeholder="請輸入 1-500 號碼">
                            <span id="currentDateTime" class="datetime-display"></span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="remarks">備註說明:</label>
                        <textarea id="remarks" name="remarks" rows="3"></textarea>
                    </div>
                    
                    <button type="submit" class="submit-btn">確認入場</button>
                </form>
            </div>
        </section>

        <!-- 入場記錄區塊 -->
        <section id="records" class="records-section">
            <h2 class="section-title">入場紀錄 - 時光流動的優雅見證</h2>
            <div class="records-controls">
                <div class="search-bar">
                    <input type="text" id="recordSearch" placeholder="搜尋櫃位號碼或備註...">
                    <button id="searchBtn" class="btn btn-primary">搜尋</button>
                </div>
                <div class="filter-options">
                    <button id="filterAll" class="filter-btn active">全部</button>
                    <button id="filterActive" class="filter-btn">使用中</button>
                    <button id="filterWarning" class="filter-btn">時間警告</button>
                    <button onclick="exportReport()" class="btn btn-primary">匯出報表</button>
                </div>
            </div>
            <div class="records-table-container">
                <table id="recordsTable" class="records-table">
                    <thead>
                        <tr>
                            <th>櫃位號碼</th>
                            <th>狀態</th>
                            <th>入場時間</th>
                            <th>暫離時間</th>
                            <th>返回時間</th>
                            <th>剩餘時間</th>
                            <th>費用資訊</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="recordsBody">
                        <!-- 每筆記錄的操作按鈕範例 -->
                        <tr>
                            <!-- ...其他欄位... -->
                            <td class="action-buttons">
                                <button class="btn btn-warning" onclick="handleTemporaryLeave(this)">暫離</button>
                                <button class="btn btn-success" onclick="handleReturn(this)">返回</button>
                                <button class="btn btn-danger" onclick="handleCheckout(this)">結帳</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div id="recordsPagination" class="pagination-controls">
                <!-- 分頁控制將在此優雅呈現 -->
            </div>
        </section>

        <!-- 票券管理區塊 -->
        <section id="tickets" class="tickets-section">
            <h2 class="section-title">票券管理 - 時光旅程的精巧鑰匙</h2>
            <div class="ticket-controls">
                <button id="addTicketBtn" class="btn btn-primary">新增票券</button>
                <div class="search-bar">
                    <input type="text" id="ticketSearch" placeholder="搜尋票券號碼...">
                    <button id="searchTicketBtn" class="btn btn-secondary">搜尋</button>
                </div>
            </div>
            <div class="ticket-list-container">
                <table id="ticketTable" class="ticket-table">
                    <thead>
                        <tr>
                            <th>票券類型</th>
                            <th>票券號碼</th>
                            <th>金額</th>
                            <th>狀態</th>
                            <th>創建日期</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="ticketBody">
                        <!-- 動態生成的票券將在此綻放 -->
                    </tbody>
                </table>
            </div>
            <!-- 新增票券的模態框 -->
            <div id="addTicketModal" class="modal">
                <div class="modal-content">
                    <h3>新增票券</h3>
                    <form id="addTicketForm">
                        <div class="form-group">
                            <label for="ticketType">票券類型</label>
                            <select id="ticketType" required>
                                <option value="H">平日券 (H)</option>
                                <option value="M">暢遊券 (M)</option>
                                <option value="P">公關票 (P)</option>
                                <option value="S">特殊節日 (S)</option>
                                <option value="L">限量販售 (L)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="ticketAmount">金額</label>
                            <input type="number" id="ticketAmount" required min="0">
                        </div>
                        <div class="form-group">
                            <label for="ticketQuantity">數量（本）</label>
                            <input type="number" id="ticketQuantity" required min="1" max="10" value="1">
                            <span class="input-hint">每本10張，最多10本</span>
                        </div>
                        <button type="submit" class="btn btn-primary">確認新增</button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">取消</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- 營業報表區塊 -->
        <section id="stats" class="stats-section">
            <h2 class="section-title">營業報表 - 時光軌跡的數字詩篇</h2>
            
            <div class="report-controls">
                <div class="time-range-selector">
                    <button class="btn btn-time active" data-range="day">日報表</button>
                    <button class="btn btn-time" data-range="week">週報表</button>
                    <button class="btn btn-time" data-range="month">月報表</button>
                </div>
                <div class="custom-range">
                    <input type="date" id="startDate" class="date-input">
                    <span>至</span>
                    <input type="date" id="endDate" class="date-input">
                    <button id="customRangeBtn" class="btn btn-primary">生成自訂報表</button>
                </div>
            </div>
        
            <div class="report-content">
                <div class="revenue-chart chart-container">
                    <h3>營業額統計</h3>
                    <canvas id="revenueChart"></canvas>
                </div>
                
                <div class="occupancy-chart chart-container">
                    <h3>櫃位使用率分析</h3>
                    <canvas id="occupancyChart"></canvas>
                </div>
                
                <div class="ticket-usage-chart chart-container">
                    <h3>票券使用統計</h3>
                    <canvas id="ticketUsageChart"></canvas>
                </div>
            </div>
        
            <div class="report-summary">
                <div class="summary-card">
                    <h4>總營業額</h4>
                    <p id="totalRevenue" class="highlight-number"></p>
                </div>
                <div class="summary-card">
                    <h4>平均櫃位使用率</h4>
                    <p id="avgOccupancy" class="highlight-number"></p>
                </div>
                <div class="summary-card">
                    <h4>票券使用總數</h4>
                    <p id="totalTicketsUsed" class="highlight-number"></p>
                </div>
         </section>

         <!-- 系統設定區塊 -->
         <section id="systemSettings" class="settings-section">
            <h2 class="section-title">系統設定 - 精細調校時光的齒輪</h2>
            
            <div class="settings-container">
                <div class="setting-group">
                    <h3>票券金額設定</h3>
                    <div class="setting-item">
                        <label for="regularTicketPrice">平日票價：</label>
                        <input type="number" id="regularTicketPrice" class="price-input" min="0">
                    </div>
                    <div class="setting-item">
                        <label for="weekendTicketPrice">假日票價：</label>
                        <input type="number" id="weekendTicketPrice" class="price-input" min="0">
                    </div>
                </div>
        
                <div class="setting-group">
                    <h3>優惠時段設定</h3>
                    <div class="setting-item">
                        <label for="discountStartTime">開始時間：</label>
                        <input type="time" id="discountStartTime" class="time-input">
                    </div>
                    <div class="setting-item">
                        <label for="discountEndTime">結束時間：</label>
                        <input type="time" id="discountEndTime" class="time-input">
                    </div>
                    <div class="setting-item">
                        <label for="discountPrice">優惠價格：</label>
                        <input type="number" id="discountPrice" class="price-input" min="0">
                    </div>
                </div>
        
                <div class="setting-group">
                    <h3>活動節日設定</h3>
                    <div class="setting-item">
                        <label for="eventName">活動名稱：</label>
                        <input type="text" id="eventName" class="text-input">
                    </div>
                    <div class="setting-item">
                        <label for="eventStartDate">開始日期：</label>
                        <input type="date" id="eventStartDate" class="date-input">
                    </div>
                    <div class="setting-item">
                        <label for="eventEndDate">結束日期：</label>
                        <input type="date" id="eventEndDate" class="date-input">
                    </div>
                    <div class="setting-item">
                        <label for="eventRecurrence">重複頻率：</label>
                        <select id="eventRecurrence" class="select-input">
                            <option value="daily">每日</option>
                            <option value="weekly">每週</option>
                            <option value="monthly">每月</option>
                            <option value="yearly">每年</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="eventTime">活動時間：</label>
                        <input type="time" id="eventTime" class="time-input">
                    </div>
                    <div class="setting-item">
                        <label for="eventDescription">活動內容：</label>
                        <textarea id="eventDescription" class="textarea-input" rows="3"></textarea>
                    </div>
                </div>
            </div>
        
            <div class="settings-actions">
                <button id="saveSettings" class="btn btn-primary">保存設定</button>
                <button id="resetSettings" class="btn btn-secondary">重置設定</button>
            </div>
        </section>
    </main>
    
    <footer>
        <p>&copy; 2024 HiMAN 管理系統 - 以技術之名，譜寫管理之詩</p>
    </footer>

    <script src="js/main.js"></script>
    <script src="js/entry.js"></script>
    <script src="js/records.js"></script>
    <script src="js/tickets.js"></script>
    <script src="js/stats.js"></script>
</body>
</html>